<%
  // Set page-specific variables for the base layout
  const pageTitle = meta.title || 'Documentation - VimNav';
  const pageDescription = meta.description || 'Complete documentation for VimNav - vim-style browser navigation. Learn all keybindings, features, and advanced usage.';
  const canonical = meta.canonical || version.canonical;

  // Build a map of versions to their output files for the client-side selector
  const versionOutputMap = versions.reduce((acc, v) => {
    acc[v.id] = v.outputFile;
    return acc;
  }, {});

  // Page-specific scripts for version navigation
  const pageScripts = `
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const versionSelect = document.getElementById('version-select');
        if (!versionSelect) return;

        const versionRoutes = ${JSON.stringify(versionOutputMap)};
        const currentVersionId = '${version.id}';

        // Ensure dropdown reflects the current version
        versionSelect.value = currentVersionId;

        versionSelect.addEventListener('change', function(e) {
          const selectedVersion = e.target.value;
          const target = versionRoutes[selectedVersion];

          if (target && target.length > 0) {
            window.location.href = target;
          }
        });
      });
    </script>
  `;

  // Build the content
  const content = `
    <!-- Documentation Header -->
    <section class="docs-header">
      <div class="container">
        <h1 class="docs-title">${meta.title || 'VimNav Documentation'}</h1>
        <p class="docs-subtitle">
          ${meta.subtitle || 'Complete guide to vim-style browser navigation with keyboard shortcuts, advanced features, and configuration options.'}
        </p>

        <!-- Version Selector -->
        ${include('version-selector.ejs', { currentVersion: version, allVersions: versions })}

        <!-- Quick Navigation -->
        ${include('docs-quick-nav.ejs', { quickNavItems: meta.quickNavItems || [] })}
      </div>
    </section>

    <!-- Quick Reference -->
    ${include('quick-reference.ejs')}

    <!-- Documentation Content -->
    <div class="docs-content">
      <div class="container">
        <div class="docs-layout">
          <!-- Sidebar Navigation -->
          ${include('docs-sidebar.ejs', { navigation: navigation })}

          <!-- Main Documentation -->
          <div class="docs-main">
            ${renderSections()}
          </div>
        </div>
      </div>
    </div>
  `;

  // Helper function to render all sections for this version
  function renderSections() {
    let html = '';

    // Define the section order to match navigation
    const sectionOrder = [
      'getting-started',
      'navigation',
      'quick-navigation',
      'modes',
      'vimedit-mode', // Only for v1.2.3+
      'search',
      'tabs',
      'hint-mode',
      'visual-mode',
      'marks',
      'commands',
      'history',
      'configuration',
      'keybinds-editor', // Only for v1.4+
      'theme-options', // Only for v1.3+
      'settings',
      'troubleshooting'
    ];

    for (const sectionId of sectionOrder) {
      if (sections[sectionId]) {
        html += sections[sectionId];
      }
    }

    return html;
  }
%>

<%- include('../layouts/base.ejs', {
  pageTitle,
  pageDescription,
  canonical,
  content,
  pageScripts
}) %>
